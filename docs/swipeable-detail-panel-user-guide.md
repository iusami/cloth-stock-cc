# SwipeableDetailPanel 使用方法ガイド

## 概要

SwipeableDetailPanel機能は、衣服詳細画面でのメモ機能とUIの視認性を大幅に改善する新機能です。メモテキストに背景色を追加し、詳細情報エリアをスワイプ操作で表示・非表示切り替えできます。

## 主な機能

### 1. メモ背景色機能

#### 概要
メモを入力すると、テキストに半透明の背景色が自動的に適用されます。これにより、背景の画像色に関係なくメモが読みやすくなります。

#### 使用方法
1. **詳細画面を開く**: 衣服アイテムをタップして詳細画面を表示
2. **メモを入力**: メモ入力エリアにテキストを入力
3. **背景の表示**: メモテキストがある場合、自動的に背景色が適用される
4. **背景の非表示**: メモを削除すると背景色も自動的に非表示になる

#### 特徴
- **自動表示**: メモテキストがある場合のみ背景が表示される
- **角丸デザイン**: 視覚的に美しい角丸の背景
- **コントラスト最適化**: WCAG準拠の4.5:1以上のコントラスト比を確保
- **アクセシビリティ対応**: スクリーンリーダーでの読み上げに対応

### 2. スワイプによるパネル制御機能

#### 概要
詳細情報エリア（メモ、タグ、その他の詳細情報）を上下のスワイプ操作で表示・非表示切り替えできます。これにより画像を全画面表示したり、詳細情報を確認したりできます。

#### 基本操作

**上スワイプ（詳細パネルを隠す）**
1. 詳細情報エリアで上方向にスワイプ
2. パネルが下に移動して非表示になる
3. 画像が全画面表示される
4. スワイプハンドルが画面下部に表示される

**下スワイプ（詳細パネルを表示）**
1. パネルが隠れている状態で、画面下部のスワイプハンドルを下方向にスワイプ
2. パネルが上に移動して表示される
3. メモ、タグ、その他の詳細情報が確認できる

**ハンドルタップ（代替操作）**
1. スワイプハンドルをタップ
2. パネルの表示・非表示が切り替わる
3. スワイプが困難な場合の代替手段

#### スワイプ操作の詳細

**スワイプ感度**
- **閾値**: パネル高さの30%以上のスワイプで状態変更
- **フリング速度**: 高速なスワイプ（1000px/s以上）でも状態変更
- **短いスワイプ**: 閾値未満の場合は元の位置に戻る

**アニメーション**
- **持続時間**: 300ms（低性能デバイスでは200ms）
- **補間**: 減速補間（DecelerateInterpolator）使用
- **スムーズな動作**: 60fpsでの滑らかなアニメーション

### 3. 状態の永続化

#### セッション中の状態保持
- パネルの表示・非表示状態は同じアプリセッション中に保持される
- 他のアイテムに移動しても設定が維持される
- 画面向き変更時も状態が保持される

#### 状態のリセット
- アプリを完全に終了すると状態がリセットされる
- 新しいセッション開始時は常にパネル表示状態になる

## デバイス対応

### 画面サイズ対応

**縦向き（Portrait）**
- パネル高さが最適化される
- コンテンツ表示領域が最大化される

**横向き（Landscape）**
- パネル高さが調整される
- 画像とパネルのバランスが最適化される

### 性能対応

**標準デバイス**
- 300msの滑らかなアニメーション
- 全ての視覚効果が有効

**低性能デバイス**
- 200msの高速化されたアニメーション
- メモリ使用量の最適化
- バッテリー消費の最小化

**アニメーション無効化設定**
- システムのアニメーション設定に準拠
- アニメーション無効時は即座に状態変更

## アクセシビリティ機能

### スクリーンリーダー対応

**SwipeHandleの説明**
- 「詳細パネルハンドル」として認識される
- タップで表示・非表示切り替え可能と説明される

**パネル状態の音声通知**
- パネル表示時: "詳細パネルが表示されました"
- パネル非表示時: "詳細パネルが非表示になりました"

**メモ背景の説明**
- メモあり: "背景付きメモ入力エリア"
- メモなし: "メモ入力エリア"

### キーボードナビゲーション

**フォーカス移動**
1. スワイプハンドル
2. メモ入力エリア
3. サイズ情報
4. 色情報
5. カテゴリ情報

**キーボード操作**
- **Enter/スペースキー**: スワイプハンドルでパネル切り替え
- **Tab**: 次の要素にフォーカス移動
- **Shift+Tab**: 前の要素にフォーカス移動

### 高コントラストモード対応

**メモ背景色**
- システムの高コントラスト設定に自動対応
- WCAG AAA基準（7:1以上）のコントラスト比を確保

**スワイプハンドル**
- 高コントラストモード時は色調整
- 視認性の確保

## トラブルシューティング

### よくある問題と解決方法

**Q: スワイプが反応しない**
A: 
- スワイプ距離が十分か確認（パネル高さの30%以上）
- アニメーション中ではないか確認
- 他のスクロール操作と競合していないか確認

**Q: アニメーションがカクつく**
A:
- デバイスのメモリ不足の可能性
- アプリの再起動を試す
- システムのアニメーション設定を確認

**Q: メモ背景が表示されない**
A:
- メモテキストが入力されているか確認
- アプリの再起動を試す
- デバイスのメモリ不足の可能性

**Q: スワイプハンドルが見えない**
A:
- パネルが正しく表示されているか確認
- 画面向きを変更してみる
- アプリの再起動を試す

### パフォーマンス最適化

**メモリ使用量削減**
- 長時間使用時は定期的にアプリを再起動
- 不要な他のアプリを終了

**バッテリー消費削減**
- システムのアニメーション設定を調整
- 低性能モードの活用

## 技術仕様

### システム要件
- Android 5.0 (API Level 21) 以上
- RAM: 2GB以上推奨
- ストレージ: 追加容量不要（既存機能の拡張）

### サポートされるジェスチャー
- 垂直スワイプ（上下方向）
- タップ（ハンドルのみ）
- フリング（高速スワイプ）

### 使用されるアニメーション
- 平行移動（translationY）
- 減速補間（DecelerateInterpolator）
- 300ms/200ms持続時間

## 更新履歴

### v1.0.0 (2024-08-14)
- SwipeableDetailPanel機能の初期リリース
- メモ背景色機能の追加
- スワイプ操作による表示・非表示切り替え
- アクセシビリティ機能の完全サポート
- 多画面サイズ・向き対応
- パフォーマンス最適化機能

---

このガイドに関する質問や問題がある場合は、プロジェクトのIssueトラッカーにお知らせください。