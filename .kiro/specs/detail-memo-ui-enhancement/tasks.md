# Implementation Plan

- [x] 1. SwipeHandleView カスタムビューの実装（TDD）
- [x] 1.1 SwipeHandleView のユニットテスト作成

  - 視覚的表示機能の失敗テストを作成する
  - タップによるパネル切り替え機能の失敗テストを作成する
  - アクセシビリティ対応の失敗テストを作成する
  - _Requirements: 3.1, 3.4, 3.5, 6.2, 6.4_

- [x] 1.2 SwipeHandleView の最小実装

  - テストを通すための最小限の SwipeHandleView クラスを作成する
  - 基本的な描画機能を実装する
  - タップリスナーの基本実装を追加する
  - _Requirements: 3.1, 3.4, 3.5, 6.2, 6.4_

- [x] 1.3 SwipeHandleView のリファクタリング

  - コードの品質向上とアクセシビリティ対応を完全実装する
  - 視覚的フィードバックの改善を行う
  - パフォーマンス最適化を実施する
  - _Requirements: 3.1, 3.4, 3.5, 6.2, 6.4_

- [x] 2. MemoInputView の背景色機能拡張（TDD）
- [x] 2.1 MemoInputView 背景色機能のユニットテスト作成

  - 背景色表示・非表示の失敗テストを作成する
  - コントラスト比チェック機能の失敗テストを作成する
  - ハイコントラストモード対応の失敗テストを作成する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 6.1, 6.5_

- [x] 2.2 MemoInputView 背景色機能の最小実装

  - テストを通すための最小限の背景色機能を実装する
  - GradientDrawable を使用した基本的な背景を追加する
  - メモテキスト有無による表示切り替えの基本実装を追加する
  - _Requirements: 1.1, 1.3, 1.4, 1.5_

- [x] 2.3 MemoInputView 背景色機能のリファクタリング

  - コントラスト比チェック機能を完全実装する
  - ハイコントラストモード対応を追加する
  - 角丸背景とパディング調整を最適化する
  - _Requirements: 1.2, 6.1, 6.5_

- [x] 3. DetailPreferencesManager の実装（TDD）
- [x] 3.1 DetailPreferencesManager のユニットテスト作成

  - パネル状態の保存・復元の失敗テストを作成する
  - 不正値のフォールバック処理の失敗テストを作成する
  - SharedPreferences 操作の失敗テストを作成する
  - _Requirements: 5.1, 5.2, 5.4, 5.5_

- [x] 3.2 DetailPreferencesManager の最小実装

  - テストを通すための最小限の PreferencesManager クラスを作成する
  - 基本的な SharedPreferences 操作を実装する
  - パネル状態の保存・復元機能の基本実装を追加する
  - _Requirements: 5.1, 5.2, 5.4, 5.5_

- [x] 3.3 DetailPreferencesManager のリファクタリング

  - エラーハンドリングと不正値のフォールバック処理を完全実装する
  - パフォーマンス最適化を実施する
  - コードの品質向上を行う
  - _Requirements: 5.1, 5.2, 5.4, 5.5_

- [x] 4. DetailViewModel の拡張（TDD）
- [x] 4.1 DetailViewModel パネル状態管理のユニットテスト作成

  - パネル状態管理機能の失敗テストを作成する
  - ViewModel ライフサイクル対応の失敗テストを作成する
  - 状態切り替えメソッドの失敗テストを作成する
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 4.2 DetailViewModel パネル状態管理の最小実装

  - テストを通すための最小限のパネル状態管理機能を実装する
  - LiveData を使用した基本的な状態管理を追加する
  - パネル状態切り替えメソッドの基本実装を追加する
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 4.3 DetailViewModel パネル状態管理のリファクタリング

  - ViewModel ライフサイクル対応を完全実装する
  - メモリリーク防止機能を追加する
  - 設定変更時の状態復元を最適化する
  - _Requirements: 5.3, 5.4_

- [x] 5. SwipeableDetailPanel カスタムビューの実装（TDD）
- [x] 5.1 SwipeableDetailPanel 基本構造のユニットテスト作成

  - パネル状態変更の失敗テストを作成する
  - 基本的なレイアウト構造の失敗テストを作成する
  - パネル状態管理の失敗テストを作成する
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 5.2 SwipeableDetailPanel 基本構造の最小実装

  - テストを通すための最小限の SwipeableDetailPanel クラスを作成する
  - ConstraintLayout ベースの基本構造を実装する
  - パネル状態（SHOWN/HIDDEN/ANIMATING）の定義と基本管理を追加する
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 5.3 SwipeableDetailPanel 基本構造のリファクタリング

  - SwipeHandleView とコンテンツコンテナーのレイアウトを最適化する
  - パネル状態管理の品質向上を行う
  - レイアウト制約の調整を実施する
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 6. SwipeableDetailPanel スワイプジェスチャー機能の実装（TDD）
- [x] 6.1 スワイプジェスチャー検出のユニットテスト作成

  - スワイプ検出の失敗テストを作成する
  - スワイプ閾値とフリング速度判定の失敗テストを作成する
  - ジェスチャー競合解決の失敗テストを作成する
  - _Requirements: 2.1, 2.2, 2.5, 4.5_

- [x] 6.2 スワイプジェスチャー検出の最小実装

  - テストを通すための最小限の GestureDetector 実装を追加する
  - 基本的なスワイプ検出機能を実装する
  - スワイプ閾値の基本判定ロジックを追加する
  - _Requirements: 2.1, 2.2, 2.5, 4.5_

- [x] 6.3 スワイプジェスチャー検出のリファクタリング

  - フリング速度の判定ロジックを完全実装する
  - ジェスチャー競合の解決機能を追加する
  - スワイプ検出の精度向上を実施する
  - _Requirements: 2.1, 2.2, 2.5, 4.5_

- [x] 7. SwipeableDetailPanel アニメーション機能の実装（TDD）
- [x] 7.1 パネルアニメーションのユニットテスト作成

  - スムーズなパネル移動の失敗テストを作成する
  - アニメーション中の状態管理の失敗テストを作成する
  - 減速アニメーションの失敗テストを作成する
  - _Requirements: 7.1, 7.2, 7.3, 7.5_

- [x] 7.2 パネルアニメーションの最小実装

  - テストを通すための最小限の ValueAnimator 実装を追加する
  - 基本的なパネル移動アニメーションを実装する
  - アニメーション中の状態管理の基本実装を追加する
  - _Requirements: 7.1, 7.2, 7.3, 7.5_

- [x] 7.3 パネルアニメーションのリファクタリング

  - 減速アニメーション（DecelerateInterpolator）を完全実装する
  - アニメーション中断処理を追加する
  - パフォーマンス最適化を実施する
  - _Requirements: 7.1, 7.2, 7.3, 7.5_

- [x]8. エラーハンドリングの実装（TDD）
- [x]8.1 SwipeGestureErrorHandler のユニットテスト作成

  - アニメーションエラー処理の失敗テストを作成する
  - ジェスチャー競合解決の失敗テストを作成する
  - 状態管理エラー処理の失敗テストを作成する
  - _Requirements: 2.5, 4.5, 5.1, 5.2, 7.2, 7.3_

- [x]8.2 SwipeGestureErrorHandler の最小実装

  - テストを通すための最小限のエラーハンドラークラスを作成する
  - 基本的なアニメーションエラー検出と復旧処理を実装する
  - 不正なパネル状態の検出と修正の基本実装を追加する
  - _Requirements: 2.5, 4.5, 5.1, 5.2, 7.2_

- [x]8.3 SwipeGestureErrorHandler のリファクタリング

  - メモリ不足時のアニメーション無効化を完全実装する
  - ジェスチャー競合の解決ロジックを最適化する
  - 設定保存失敗時のフォールバック処理を追加する
  - _Requirements: 7.3_

- [x]9. デバイス対応とパフォーマンス最適化の実装（TDD）
- [x]9.1 デバイス対応機能のユニットテスト作成

  - ローエンドデバイス対応の失敗テストを作成する
  - アクセシビリティ設定対応の失敗テストを作成する
  - 画面サイズ対応の失敗テストを作成する
  - _Requirements: 4.2, 4.3, 4.4, 6.3, 6.4, 7.4_

- [x]9.2 デバイス対応機能の最小実装

  - テストを通すための最小限のデバイス性能検出を実装する
  - 基本的な画面サイズ対応を追加する
  - システム設定の基本検出機能を実装する
  - _Requirements: 4.2, 4.3, 4.4_

- [x]9.3 デバイス対応機能のリファクタリング

  - 低性能デバイス向けの簡略化アニメーションを完全実装する
  - アクセシビリティサービス向けの状態アナウンスを追加する
  - メモリ使用量の最適化を実施する
  - _Requirements: 6.3, 6.4, 7.4_

- [x] 10. DetailActivity のレイアウト更新（TDD）
- [x] 10.1 DetailActivity レイアウトのインストルメンテーションテスト作成

  - 新しいレイアウト構造の失敗テストを作成する
  - 画面向き対応の失敗テストを作成する
  - レイアウト統合の失敗テストを作成する
  - _Requirements: 2.3, 2.4, 4.2, 4.3, 5.3_

- [x] 10.2 DetailActivity レイアウトの最小実装

  - テストを通すための最小限のレイアウト変更を実装する
  - フルスクリーン画像表示と SwipeableDetailPanel の基本統合を追加する
  - 既存の MemoInputView を SwipeableDetailPanel 内に配置する
  - _Requirements: 2.3, 2.4_

- [x] 10.3 DetailActivity レイアウトのリファクタリング

  - 縦向き・横向きでのレイアウト最適化を完全実装する
  - 向き変更時のパネル状態保持を追加する
  - 異なる画面サイズでのスワイプ閾値調整を実施する
  - _Requirements: 4.2, 4.3, 5.3_

- [ ] 11. リソースファイルの作成
- [ ] 11.1 レイアウトリソースの作成

  - SwipeableDetailPanel のレイアウト XML を作成する
  - SwipeHandleView のレイアウト XML を作成する
  - 画面サイズ別のレイアウトバリエーションを作成する
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 11.2 カラーリソースとディメンションの作成

  - メモ背景色とスワイプハンドル色を定義する
  - ハイコントラストモード用の色を定義する
  - パネルアニメーション用のディメンション値を定義する
  - _Requirements: 1.1, 1.2, 6.1, 6.5_

- [ ] 11.3 文字列リソースの作成

  - アクセシビリティ用の説明文を作成する
  - パネル状態変更のアナウンス文を作成する
  - エラーメッセージの文字列を作成する
  - _Requirements: 6.2, 6.3, 6.4_

- [ ] 12. 統合テストとアクセシビリティテストの実装
- [ ] 12.1 スワイプジェスチャーの統合 UI テスト作成

  - 上スワイプによるパネル非表示のテストを作成する
  - 下スワイプによるパネル表示のテストを作成する
  - スワイプハンドルタップのテストを作成する
  - _Requirements: 2.1, 2.2, 3.5_

- [ ] 12.2 メモ背景色の統合 UI テスト作成

  - メモ入力時の背景表示テストを作成する
  - メモクリア時の背景非表示テストを作成する
  - 背景色のコントラスト確認テストを作成する
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 12.3 アクセシビリティテストの作成

  - SwipeHandleView のアクセシビリティテストを作成する
  - パネル状態変更のアナウンステストを作成する
  - キーボードナビゲーションのテストを作成する
  - コントラスト比とハイコントラストモードテストを作成する
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 13. パフォーマンステストと最終統合テスト
- [ ] 13.1 パフォーマンステストの作成

  - スムーズなパネル移動のパフォーマンステストを作成する
  - ローエンドデバイスでの動作テストを作成する
  - メモリ使用量の監視テストを作成する
  - 長いメモテキストでの背景表示テストを作成する
  - _Requirements: 1.5, 4.4, 7.1, 7.2, 7.3, 7.4_

- [ ] 13.2 最終統合テストの作成

  - 既存の image-memo 機能との統合確認テストを作成する
  - メモ入力から背景表示までの完全フローテストを作成する
  - パネル操作から状態保存までの完全フローテストを作成する
  - アクセシビリティ機能の完全フローテストを作成する
  - _Requirements: 1.1, 2.1, 5.1, 6.1_

- [ ] 14. ドキュメント更新と最終調整
  - 新機能の使用方法ドキュメントを作成する
  - アクセシビリティガイドラインの更新を行う
  - パフォーマンス最適化の設定ガイドを作成する
  - 既存機能への影響がないことを最終確認する
  - _Requirements: 6.1, 6.2, 6.3, 6.4_
