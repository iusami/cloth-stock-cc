# Implementation Plan

- [ ] 1. データモデルとデータベーススキーマの拡張
  - ClothItemエンティティにmemoフィールドを追加し、バリデーション機能を実装する
  - データベースマイグレーション（v1→v2）を作成してmemoカラムを追加する
  - メモ関連のヘルパーメソッド（withUpdatedMemo、hasMemo、getMemoPreview）を実装する
  - _Requirements: 1.1, 1.2, 1.3, 5.1, 5.2_

- [ ] 2. データアクセス層の拡張
  - ClothDaoにメモを含む検索クエリを追加する
  - 既存の検索メソッドをメモ検索対応に拡張する
  - メモ検索用のデータベースインデックスを作成する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 5.1_

- [ ] 3. リポジトリ層の更新
  - ClothRepositoryインターフェースにメモ検索メソッドを追加する
  - ClothRepositoryImplでメモ検索機能を実装する
  - 既存の検索機能とメモ検索の統合を行う
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 4. カスタムUIコンポーネントの作成
- [ ] 4.1 MemoInputViewカスタムビューの実装
  - メモ入力用のEditTextとキャラクターカウンターを含むカスタムビューを作成する
  - リアルタイム文字数カウント機能を実装する
  - 文字数制限の視覚的フィードバック機能を実装する
  - _Requirements: 1.1, 1.3, 1.4, 6.1, 6.2, 6.3_

- [ ] 4.2 MemoIndicatorViewカスタムビューの実装
  - ギャラリービューでメモ有無を示すインジケーターを作成する
  - メモがある場合の視覚的表示機能を実装する
  - アクセシビリティ対応（contentDescription）を実装する
  - _Requirements: 4.1, 4.2, 6.2_

- [ ] 5. DetailActivityのメモ機能統合
  - DetailActivityのレイアウトにMemoInputViewを追加する
  - DetailViewModelにメモ保存・更新機能を実装する
  - メモ変更時の自動保存機能を実装する
  - メモ保存エラー時のエラーハンドリングを実装する
  - _Requirements: 1.1, 1.2, 1.4, 2.1, 2.2, 2.4_

- [ ] 6. GalleryFragmentのメモ表示機能統合
  - ClothItemAdapterにメモインジケーター表示機能を追加する
  - メモプレビュー表示機能を実装する
  - メモプレビュータップ時の詳細画面遷移を実装する
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 7. 検索機能のメモ対応拡張
  - GallerySearchManagerでメモ検索機能を統合する
  - 既存のテキスト検索にメモ内容を含める機能を実装する
  - フィルター検索とメモ検索の組み合わせ機能を実装する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 8. エラーハンドリングとバリデーション
  - MemoErrorHandlerクラスを作成してメモ関連エラーを処理する
  - メモ保存失敗時のリトライ機能を実装する
  - メモ文字数制限のバリデーション機能を実装する
  - _Requirements: 1.3, 1.4, 2.4_

- [ ] 9. ユニットテストの実装
- [ ] 9.1 データモデルテストの作成
  - ClothItemのメモ関連メソッドのテストを作成する
  - メモバリデーション機能のテストを作成する
  - メモ文字数制限のテストを作成する
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 9.2 DAOテストの作成
  - メモ検索クエリのテストを作成する
  - メモを含むフィルター検索のテストを作成する
  - データベースマイグレーションのテストを作成する
  - _Requirements: 3.1, 3.2, 3.3, 5.1, 5.2_

- [ ] 9.3 リポジトリテストの作成
  - メモ検索機能のテストを作成する
  - メモ保存・更新機能のテストを作成する
  - エラーハンドリングのテストを作成する
  - _Requirements: 3.1, 3.2, 2.1, 2.2_

- [ ] 10. インストルメンテーションテストの実装
- [ ] 10.1 MemoInputViewのUIテスト
  - メモ入力機能のEspressoテストを作成する
  - 文字数制限の視覚的フィードバックのテストを作成する
  - メモ保存機能のUIテストを作成する
  - _Requirements: 1.1, 1.3, 1.4, 6.1, 6.3_

- [ ] 10.2 ギャラリービューのメモ表示テスト
  - メモインジケーター表示のテストを作成する
  - メモプレビュー表示のテストを作成する
  - メモプレビュータップ機能のテストを作成する
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 10.3 検索機能のUIテスト
  - メモ内容での検索機能のテストを作成する
  - 検索結果表示のテストを作成する
  - フィルターとメモ検索の組み合わせテストを作成する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 11. 統合テストとパフォーマンステスト
  - メモ検索機能の統合テストを作成する
  - 大量データでのメモ検索パフォーマンステストを作成する
  - メモ機能全体のエンドツーエンドテストを作成する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 5.1, 5.2_

- [ ] 12. アクセシビリティ対応の実装
  - メモ入力フィールドのアクセシビリティ対応を実装する
  - メモインジケーターのスクリーンリーダー対応を実装する
  - キーボードナビゲーション対応を実装する
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 13. 最終統合とテスト
  - 全機能の統合テストを実行する
  - パフォーマンステストを実行して最適化を行う
  - アクセシビリティテストを実行して対応を確認する
  - 既存機能への影響がないことを確認する
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1_